machine:
  services:
    - docker
  environment:
    GODIST: "go1.8.linux-amd64.tar.gz"
  post:
    # install latest version of go
    - mkdir -p download
    - test -e download/${GODIST} || curl -o download/${GODIST} https://storage.googleapis.com/golang/${GODIST}
    - sudo rm -rf /usr/local/go
    - sudo tar -C /usr/local -xzf download/${GODIST}
    - go version

dependencies:
  pre:
    - docker run --name cassandra -d -p 7000:7000 -p 9042:9042 cassandra:3.7
  override:
    # './...' is a relative pattern which means all subdirectories
    - go get -t -d -v ./...
    - go build -v

test:
  pre:
    - go vet ./...
    # connect to docker cassandra instance to install test scripts
    - docker run --link cassandra:cassandra -v $PWD/test/config/cassandra:/config cassandra:3.7 /config/wait-for-cassandra.sh cassandra cqlsh -f /config/commands.cql cassandra
  override:
    - go test -v .
